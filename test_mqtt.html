<!DOCTYPE html>
<html>
<head>
	<title>test MQTT Broker</title>
</head>
<body>
  <div>User ID: <div id="user_id"></div></div>
	<div id="message_arrive">Creating conncetion with ESP8266 device...</div>
	<input type="text" name="message_text" id="message_text" required width="200px">
	<button id="message_send" onclick="message_send();">Send message</button>

	<script type="text/javascript">
		function message_send()
		{
			var data = document.getElementById("message_text").value;
			console.log("sending: " + data);
			message = new Paho.MQTT.Message(data);
			message.destinationName = "client_user";
			client.send(message);
		}
	</script>
</body>
</html>

<script src="mqttws31.js" type="text/javascript"></script>
<script type="text/javascript">

  // Create a client instance
  var user_id = "1" + parseInt(Math.random() * 100, 10);
  document.getElementById("user_id").innerHTML = user_id;

  client = new Paho.MQTT.Client("m14.cloudmqtt.com", 30982, user_id);

  // set callback handlers
  client.onConnectionLost = onConnectionLost;
  client.onMessageArrived = onMessageArrived;
  var options = {
    useSSL: true,
    userName: "lffknbep",
    password: "a1MJ1J3WSCbm",
    onSuccess:onConnect,
    onFailure:doFail
  }
  // connect the client
  client.connect(options);



  

  // called when the client connects
  function onConnect() {
    // Once a connection has been made, make a subscription and send a message.
    console.log("onConnect");
    client.subscribe("client_user");
    message = new Paho.MQTT.Message("Hello CloudMQTT");
    message.destinationName = "client_user";
    client.send(message);
  }

  function doFail(e){
    console.log(e);
  }

  // called when the client loses its connection
  function onConnectionLost(responseObject) {
    if (responseObject.errorCode !== 0) {
      console.log("onConnectionLost:"+responseObject.errorMessage);
    }
  }

  // called when a message arrives
  function onMessageArrived(message) {
    console.log("onMessageArrived:" + message.payloadString);
    document.getElementById("message_arrive").innerHTML += "<br>message_arrive: " + message.payloadString;
  }
</script>